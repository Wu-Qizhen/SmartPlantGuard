# 《智能植保微环境控制器》项目考核任务书

## 1. 描述

本项目旨在设计一个能够自动调节植物生长环境的智能化硬件系统（Smart Plant Guard），通过集成传感器采集、逻辑判断、执行器控制以及远程交互，模拟现代智慧农业的最小闭环系统

- 通俗目标：这是一个会“照顾植物”的管家。它能监测土干不干、天热不热，自动开关水泵浇水或风扇降温，（选做）并在手机 / 电脑上查看实时情况
- 技术亮点：
  1. 硬件工程化：摆脱杜邦线，自主设计 PCB，处理 12V-5V-3.3V 混合电路及大电流干扰，掌握如何用单片机的 3.3V 弱电信号安全地控制 12V 的水泵与风扇
  2. 鲁棒性算法：引入滞回逻辑（Hysteresis），有效防止执行器（如继电器）在临界点频繁启停导致硬件损坏
  3. 低功耗设计：学习如何在保证监控实时性的前提下，利用 STM32 的休眠机制降低能耗（选做）



## 2. 内容与要求

### 2.1 硬件工程师（成员 A）

- 核心任务：负责原理图及 PCB 设计
- 技术要求：
  1. 电源树设计：实现 12V（总入口）→ 5V（风扇、水泵）→ 3.3V（MCU、传感器）的两级降压逻辑
  2. 电路：必须设计三极管驱动电路（如 S8050）或光耦隔离电路，解决 MCU 引脚电流无法驱动继电器的问题
  3. 安全性：PCB 需考虑大电流走线加宽、防反接二极管及续流二极管保护

### 2.2 软件算法工程师（成员 B）

- 核心任务：编写核心控制逻辑与协议栈
- 技术要求：
  1. 多任务调度：基于 FreeRTOS 实现多任务，如：传感器读取任务、控制逻辑逻辑、串口协议下发
  2. 抗抖动算法：必须实现滞回逻辑。例如：土壤湿度低于 30% 开启水泵，必须等升至 40% 才关闭，防止在 30% 边界处反复开关
  3. 本地存储：在 Flash 内实现参数保存（如用户设定的浇水阈值），断电不丢失

### 2.3 系统集成与交互工程师（成员 C）

- 核心任务：负责监控界面及远程告警
- 技术要求：
  1. 交互端开发：开发一个简易的监控面板（如网页、手机 App 或上位机），通过 WiFi / 蓝牙接收数据
  2. 异常处理：实现“水箱缺水”或“温度过高”的远程预警功能



## 3. 核心技术考核

### 3.1 负载驱动电路（核心硬件考核）

针对水泵和风扇的控制，需从以下两种方案中进行选择：

1. 方案一：继电器驱动电路（基础必做）
   - 实现要求：使用三极管（如 S8050）驱动 5V / 12V 继电器
   - 考核重点：必须包含续流二极管保护电路；理解继电器物理隔离的原理
   - 功能：实现水泵的完全开启或完全关闭
2. 方案二：MOSFET 驱动电路（进阶选做，加分项）
   - 实现要求：使用逻辑电平 MOSFET（如 IRLZ44N）构建开关电路
   - 考核重点：栅极下拉电阻的设计；PWM 调速控制的实现
   - 功能优势：除了开关控制外，需通过 PWM 调节水泵流量或风扇转速（例如：温度越高，风扇转得越快）



## 4. 需要购买的硬件清单

- 主控：STM32 系列开发板（30 元内）
- 传感器：电容式土壤湿度传感器、DHT11 温湿度、光敏电阻
- 执行器：5V 继电器、小型水泵、5V 小型风扇、补光灯条
- 电源：12V 1A 电源适配器 + DC 插座
- PCB 组件：LM2596 / MP2307（DCDC）、AMS1117-3.3（LDO）、三极管、二极管、电感电容包



## 5. 工程规范

1. 硬件规范：PCB 走线需区分信号线与动力线，大电流路径需铺铜加粗

2. 硬件稳定性：PCB 必须有明确的信号地和功率地划分，严禁在执行器启动时导致单片机重启

3. 代码规范：
   - 禁止代码耦合：传感器读取/控制函数严禁直接操作，必须通过中间逻辑变量 / 函数控制
   - 禁止“魔术数字”：所有的引脚定义、控制阈值必须使用 `#define`
   - 变量命名：使用有意义的英文（如 `temp_celsius` 而不是 `t1`）
   - Git 版本控制：使用 GitHub / Gitee 进行协作，主分支只保留稳定代码，功能开发在个人分支进行，至少包含 5 次以上具有实际意义的 Commit 记录（严禁一次性提交全部代码）
   - 注释要求：每个函数上方必须说明：这个函数是干嘛的？输入是什么？输出是什么？



## 6. 进阶挑战

- 电流监测：加入 INA219 电流检测芯片。通过总线监测水泵运行电流，若检测到继电器闭合但电流无变化，则在界面提示“水泵故障或断路”

- 物联网功能: 使用 ESP 单片机或者 WiFi 模块的联网功能，使用 OneNet 等云平台传输数据，并编写一个简单的手机 APP 进行数据监测

- 多芯片主从机控制：项目中使用多个单片机 / 芯片，其中从机只负责读取传感器数据，并将数据发送给主机，主机只负责读取从机数据和发布控制指令

- 定义一套通用的“二进制协议包”：利用 C 语言的 `union` 特性，在一个数据包中实现浮点数、整数、状态位在多机之间的无损传输

- OTA 升级：实现通过 WiFi 远程更新单片机固件