# 智能植保微环境控制器

## 项目简介

智能植保微环境控制器是一个基于 STM32 的智能植物养护系统，通过传感器实时监测植物生长环境的温湿度、土壤湿度和光照强度等参数，根据预设阈值自动控制水泵、风扇等执行器，为植物提供最佳的生长环境

## 功能特性

- **实时监测**：监测土壤湿度、空气温湿度、光照强度
- **自动控制**：基于滞回控制算法自动控制水泵和风扇
- **蓝牙通信**：通过蓝牙模块与手机 APP 通信，实现远程控制和数据查看
- **WiFi预留**：预留 WiFi 接口，支持未来扩展网络功能
- **数据存储**：将控制参数存储在 Flash 中，断电不丢失
- **安全保护**：包含水泵间隔保护、风扇过热保护等安全机制

## 硬件组成

- **主控**：STM32 系列微控制器
- **传感器**：电容式土壤湿度传感器、DHT11 温湿度传感器、光敏电阻
- **执行器**：5V 继电器、小型水泵、5V 小型风扇
- **通信**：HC-05 蓝牙模块、预留 ESP8266 WiFi 接口
- **电源**：12V 电源适配器

## 软件架构

项目采用模块化设计，主要包含以下模块：

1. **System 模块**：系统配置和状态管理
2. **Sensor 模块**：传感器数据采集和处理
3. **Actuator 模块**：执行器控制
4. **Controller 模块**：核心控制逻辑和任务调度
5. **Communication 模块**：蓝牙和WiFi通信

## 目录结构

```
SmartPlantGuard/
├── README.md                   # 项目说明文档
├── .gitignore                  # Git 忽略文件
├── CMakeLists.txt              # CLion 项目配置文件
├── STM32CubeMX/                # CubeMX 工程文件
├── Core/                       # 核心代码
│   ├── Inc/                    # 头文件
│   └── Src/                    # 源文件
├── Drivers/                    # 驱动文件
├── Modules/                    # 功能模块
│   ├── System/                 # 系统模块
│   ├── Sensor/                 # 传感器模块
│   ├── Actuator/               # 执行器模块
│   ├── Controller/             # 控制模块
│   └── Communication/          # 通信模块
├── Tools/                      # 工具文件
└── Docs/                       # 文档
```

## 快速开始

1. **硬件搭建**：按照原理图连接硬件电路
2. **软件配置**：使用 STM32CubeMX 配置工程
3. **代码编译**：使用 CLion 编译代码
4. **烧录程序**：将编译好的程序烧录到 STM32 开发板
5. **蓝牙连接**：使用手机蓝牙串口 APP 连接设备

## 通信协议

系统使用自定义的串口通信协议，通过蓝牙与手机 APP 通信。协议格式如下：

```
起始字节（0xAA—） + 指令类型 + 数据长度 + 数据 + 校验和 + 结束字节（0x55）
```

## 控制参数

| 参数 | 默认值 | 范围 | 说明 |
|------|--------|------|------|
| 土壤湿度低阈值 | 30% | 0-100% | 低于此值开启水泵 |
| 土壤湿度高阈值 | 40% | 0-100% | 高于此值关闭水泵 |
| 温度高阈值 | 30°C | 0-50°C | 高于此值开启风扇 |
| 温度低阈值 | 25°C | 0-50°C | 低于此值关闭风扇 |
| 滞回带宽 | 2%/°C | 0-10%/°C | 防止频繁切换 |
| 水泵最小间隔 | 60 秒 | 0-3600秒 | 防止频繁启动 |
| 水泵最大持续时间 | 30 秒 | 0-300秒 | 防止过度浇水 |

## 注意事项

1. **电源安全**：使用合适的电源适配器，确保电压稳定
2. **传感器连接**：土壤湿度和光敏传感器必须接 3.3V，绝对不能接 5V
3. **继电器驱动**：继电器需要使用三极管驱动电路，包含续流二极管
4. **蓝牙模块**：HC-05 模块需要正确配置波特率和配对码
5. **防水处理**：土壤湿度传感器需要做好防水处理

## 故障排除

| 故障现象 | 可能原因 | 解决方法 |
|---------|---------|--------|
| 传感器无数据 | 接线错误或传感器故障 | 检查接线，更换传感器 |
| 执行器不工作 | 继电器故障或驱动电路问题 | 检查继电器和驱动电路 |
| 蓝牙连接失败 | 模块未配置或距离过远 | 重新配置模块，缩短距离 |
| 系统不稳定 | 电源不稳定或代码问题 | 检查电源，调试代码 |

## 版本历史

## 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件

## 联系方式

如有问题或建议，欢迎联系我们